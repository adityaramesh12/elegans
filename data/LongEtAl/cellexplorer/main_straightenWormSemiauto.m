function outimg = main_straightenWormSemiauto(inimg,id_gfp, id_dapi) %  function outimg = main_straightenWormSemiauto(inimg,id_gfp, id_dapi) %% semi-automatic worm straightening% Copyright Fuhui Long% 20060528inputarg = inimg;if isa(inputarg, 'char'),    inimg = uint8(readim(inputarg));else,     inimg = uint8(inputarg); end;nd = ndims(inimg);if (nd<3 | nd>5),    error('You have to specify a stack with 3 or 4 dimensions.');    return;end;while 1,    c12 = elegan_manualFindWormBoundary(inimg,id_gfp, id_dapi);     [bpos] = elegantail_backbone_2d(uint8(double(c12)+0));      c = repmat(uint8(0), size(inimg,1), size(inimg,2));      for i=1:length(bpos), c(round(bpos(i).x), round(bpos(i).y))=1; end;      if (nd>=4),        overlay(mean(squeeze(inimg(:,:,:,1)),3), c, [255 0 0])      else,        overlay(mean(inimg,3), c, [255 0 0])      end;      break;end;Kwid = 140;time0 = cputime;if ndims(inimg)==3,    outimg = straighten_worm_0730(inimg, bpos, Kwid);else,    for i=1:size(inimg,4),        outimg(:,:,:,i) = straighten_worm_0730(squeeze(inimg(:,:,:,i)), bpos, Kwid);    end;end;fprintf('Time cost (second) to straighten this stack: %5.2f\n', cputime-time0);return;